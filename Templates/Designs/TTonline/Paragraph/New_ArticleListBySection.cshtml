@inherits Dynamicweb.Rendering.RazorTemplateBase<Dynamicweb.Rendering.RazorTemplateModel<Dynamicweb.Rendering.Template>>
@using System
@using System.Web;
@using System.Collections;
@using System.Collections.Generic
@using System.Linq;
@using Dynamicweb.Content.Items

@Include("Layout.cshtml")
@Include("../Custom/GlobalVariables.cshtml")
@Include("../Includes/ArticleHelper.cshtml")
@Include("../Includes/GetImage_new.cshtml")

@{
	var pageId = GetPageIdByNavigationTag("ArticlesFeed");
	var articlesIDs = "";
	foreach (LoopItem i in GetLoop("Item.Featured_Article"))
	{
		var slideId = i.GetString("Item.Featured_Article.Id");
		var pageService = new Dynamicweb.Content.PageService();
		articlesIDs += pageService.GetPageForItem("Dw_Page", slideId.ToString()).ID + ",";
	}
}

@NewRow() 


<div class="@ColumnClass() homepage-sectiune" style="margin-top: 25px; margin-bottom:0px">
	<h3 class="block-title"><span>@GetString("Item.ParagraphName")</span></h3>
	@RenderFeaturedArticle()
	@RenderArticleList()
	@RenderModule() 
</div>

@helper RenderFeaturedArticle()
{
	<div id="ArticleListBySection" class="handlebars-wrapper" data-template="ArticleListBySectionTemplate" data-json-feed="/Default.aspx?ID=@pageId&PageID=@articlesIDs">
		<div class="loader"></div>
		@*HANDLEBARS TEMPLATE GOES HERE*@
	</div>
	<script id="ArticleListBySectionTemplate" type="text/x-handlebars-template">
	{{#ArticlesContainer}}
		{{#each Article}}
			<article class="news-block">
            	<a href="/Default.aspx?ID={{pagePageID}}" class="overlay-link">

            		<figure class=" ">	
            			<img src="/Admin/Public/GetImage.ashx?Image={{itemImaginePrincipala}}&Crop=0&Format=jpg&Width=730&Height=355" alt="{{itemTitlu}}" class="img-responsive" />
            		</figure>
               <a href='/Default.aspx?ID={{itemSectiuneParinteId}}' class="bg{{itemSectiuneParinteId}} category">{{itemSectiuneParinte}}</a>
            	</a>

            	{{#articleSections}}
                    <a href="#" class="category bgcolor3">{{Name}}</a>
                {{/articleSections}}
            	<header class="news-details">
            		<h3 class="news-title"> <a href='/Default.aspx?ID={{pagePageID}}' alt='{{itemTitlu}}'>{{itemTitlu}}</a></h3>
            		    <p>{{{itemSumar}}}</p>
            	        <p class="simple-share">@Translate("articolde","de")  
            	        {{#itemAutori}}
                        
                            <a href="{{Link}}"><b>{{Name}}</b></a>
                        {{/itemAutori}}
            	        - <span class="article-date"><i class="fa fa-clock-o"></i> {{itemData}}</span>
                          {{#if showItemVisits}}
                                        <span>  -  <i class="fa fa-eye"></i> {{itemVisits}} vizualizari</span>
                          {{/if}}
            			</p>
            	</header>  
            </article><!-- News block -->
		{{/each}}
	{{/ArticlesContainer}}
	
	</script>
	
}

@helper RenderArticleList()
{
	string listTemplate = GetString("Item.Display").Replace("1", "one").Replace("2", "two").Replace("3", "three");
	var noSummary = listTemplate.Contains("nosummary");
	var noImage = listTemplate.Contains("noimage");
	
	<div class="list-container @listTemplate" data-template="ArticleListBySectionTemplate" data-json-feed="/Default.aspx?ID=@pageId&PageID=@articlesIDs">
		<div class="loader"></div>
		@*HANDLEBARS TEMPLATE GOES HERE*@
	</div>
	<script id="ArticleListBySectionTemplate" type="text/x-handlebars-template">
	{{#ArticlesContainer}}
	{{#Article}}
	<article class="news-block small-block">
			@if (!noImage)
			{
				
				<a href="/Default.aspx?ID={{pagePageID}}" class="overlay-link">
					<figure class=" ">
						<img src="/Admin/Public/GetImage.ashx?Image={{itemImaginePrincipala}}&Crop=0&Format=jpg&Width=730&Height=355" alt="{{itemTitlu}}" class="img-responsive"/>
					</figure>
				</a>
			}

			<a href='/Default.aspx?ID={{itemSectiuneParinteId}}' class="bg{{itemSectiuneParinteId}} category">{{itemSectiuneParinte}}</a>
			<header class="news-details">

				<h3 class="{{itemTitlu}}"><a href="/Default.aspx?ID={{pagePageID}}">{{itemTitlu}}</a></h3>
				<p class="simple-share">

					@Translate("articolde", "de")
					{{#articleAutori}}
					<a href="{{Link}}">{{Name}}</a>
					{{/articleAutori}}
					<br/>
					<span><i class="fa fa-clock-o"></i>{{itemData}}</span>
					@*TODO conditie de afisafe din feed *@
					{{#if showItemVisits}}
                        <span>  -  <i class="fa fa-eye"></i> {{itemVisits}} vizualizari</span>
                    {{/if}}
				</p>
				@if (!noSummary)
				{
					<div class="excerpt">
                       {{{itemSumar}}}
                    </div>
				}
			</header>
			
		</article>
		{{/Article}}
		{{/ArticlesContainer}}
	</script>

}


@helper RenderModule()
{
	@GetString("ParagraphModule")
}


@foreach(LoopItem j in GetLoop("Item.Featured_Article")){

	string articleSectiune = j.GetString("Item.Featured_Article.SectiuneParinte");
 	int articleSectiuneID = j.GetInteger("Item.Featured_Article.SectiuneParinteId");

 	<div class="col-md-12 col-xs-12 load-more">
      <a href="/Default.aspx?ID=@articleSectiuneID"><button type="button" class="btn btn-lg btn-block">@Translate("maimulte","Mai multe")</button></a>
    </div>

}


                